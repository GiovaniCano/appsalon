{"version":3,"sources":["app.js"],"names":["APIbaseURL","paso","cita","usuarioId","nombre","fecha","hora","servicios","iniciarAPP","tabs","botonesPaginador","paginaAnterior","paginaSiguiente","consultarAPI_jQuery","idCliente","nombreCliente","seleccionarFecha","seleccionarHora","reservarCita_jQuery","datos","map","servicio","id","$","ajax","url","method","dataType","data","error","alertaErrorPOST","success","respuesta","resultado","Swal","fire","icon","title","text","customClass","popup","then","window","location","reload","async","reservarCita_Fetch","idServicios","FormData","append","fetch","body","json","footer","mostrarResumen","resumen","Object","values","includes","length","children","remove","mostrarAlerta","split","join","Date","toLocaleDateString","year","weekday","day","month","toUpperCase","substring","html","fechaCita","horaCita","forEach","precio","contenedorServicio","addClass","textoServicio","precioServicio","botonReservar","on","e","horaSeleccionada","this","val","fechaSeleccionada","dia","getUTCDay","mensaje","tipo","elemento","desaparece","alerta","prepend","setTimeout","quitarAlertas","consultarAPI_Fetch","mostrarServicios","cl","type","response","timeout","nombreServicio","precioServicios","servicioDiv","attr","seleccionarServicio","some","filter","removeClass","mostrarSeccion","foo","console","log"],"mappings":"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","file":"app.js","sourcesContent":["const APIbaseURL = \"http://localhost:3000/api/\"\r\n// const APIbaseURL = \"http://127.0.0.1:3000/api/\"\r\n\r\nlet paso = 1\r\nconst cita = {\r\n    usuarioId: \"\",\r\n    nombre: \"\",\r\n    fecha: \"\",\r\n    hora: \"\",\r\n    servicios: []\r\n}\r\n\r\n$(function(){\r\n    iniciarAPP()\r\n})\r\nfunction iniciarAPP() {\r\n    tabs() //cambia la seccion cuando se presionen los tabs\r\n    botonesPaginador() //agrega o quita los botones del paginador\r\n    paginaAnterior()\r\n    paginaSiguiente()\r\n\r\n    // consultarAPI_Fetch()\r\n    consultarAPI_jQuery()\r\n\r\n    idCliente() //añade el id del cliente al objeto de cita\r\n    nombreCliente() //añade el nombre del cliente al objeto de cita\r\n    seleccionarFecha() //añade la fecha de la cita en el objeto\r\n    seleccionarHora() //añade la hora de la cita en el objeto\r\n}\r\n\r\n/* Cita */\r\nfunction reservarCita_jQuery() {\r\n    const datos = {...cita}\r\n    datos.servicios = datos.servicios.map(servicio=>servicio.id)\r\n    $.ajax({\r\n        url: \"/api/citas\",\r\n        method: \"post\",\r\n        dataType: \"json\",\r\n        data: datos,\r\n        error: alertaErrorPOST,\r\n        success: function(respuesta) {\r\n            if(respuesta.resultado.resultado) {\r\n                //@ts-ignore\r\n                Swal.fire({\r\n                    icon: 'success',\r\n                    title: 'Cita Creada',\r\n                    text: 'Tu cita fué creada correctamente',\r\n                    customClass: {popup:\"swal2-custom-size\"},\r\n                    // confirmButtonText: \"Ok\"\r\n                }).then(()=>window.location.reload())\r\n            } else {\r\n                alertaErrorPOST()\r\n            }\r\n        }\r\n    })\r\n}\r\nasync function reservarCita_Fetch() {\r\n    const {usuarioId, fecha, hora, servicios} = cita\r\n\r\n    const idServicios = servicios.map(servicio=>servicio.id)\r\n\r\n    const datos = new FormData()\r\n    datos.append(\"usuarioId\", usuarioId)\r\n    datos.append(\"fecha\", fecha)\r\n    datos.append(\"hora\", hora)\r\n    datos.append(\"servicios\", idServicios)\r\n    // cl([...datos]); return\r\n\r\n    try {\r\n        /* peticion hacia la api */\r\n        const respuesta = await fetch(\"/api/citas\", {\r\n            method: 'post',\r\n            body: datos\r\n        })\r\n        const resultado = await respuesta.json()\r\n        if(resultado.resultado.resultado) {\r\n            //@ts-ignore\r\n            Swal.fire({\r\n                icon: 'success',\r\n                title: 'Cita Creada',\r\n                text: 'Tu cita fué creada correctamente',\r\n                customClass: {popup:\"swal2-custom-size\"},\r\n                // confirmButtonText: \"Ok\"\r\n            }).then(()=>window.location.reload())\r\n        } else {\r\n            alertaErrorPOST()\r\n        }\r\n    } catch (error) {\r\n        alertaErrorPOST()\r\n    }\r\n}\r\nfunction alertaErrorPOST() {\r\n    //@ts-ignore\r\n    Swal.fire({\r\n        icon: 'error',\r\n        title: 'Error',\r\n        text: 'Hubo un error al guardar la cita',\r\n        customClass: {popup:\"swal2-custom-size\"},\r\n        footer: `<a href=\"/cita\">Recargar la página</a>`\r\n    })\r\n}\r\n\r\nfunction mostrarResumen() {\r\n    const resumen = $(\"#resumen\")\r\n    if(Object.values(cita).includes(\"\") || cita.servicios.length === 0) {\r\n        resumen.children().remove()\r\n        mostrarAlerta(\"Faltan datos o elegir al menos un servicio\", \"error\", \"#resumen\", false)\r\n    } else {\r\n        resumen.children().remove()\r\n\r\n        const {nombre, servicios} = cita\r\n\r\n        let hora = cita.hora.split(\":\")\r\n        if(hora[0] > 12) {\r\n            hora = hora[0]-12+\":\"+hora[1]+\" p.m.\"\r\n        } else if(hora[0] == 12) {\r\n            hora = hora.join(\":\")+\" p.m.\"\r\n        } else {\r\n            hora = hora.join(\":\")+\" a.m.\"\r\n        }\r\n        /* fecha vanilla JS */\r\n            let fecha = cita.fecha.split(\"-\")\r\n            fecha = new Date(fecha[0], fecha[1]-1, fecha[2])\r\n            fecha = fecha.toLocaleDateString(\"es\", {year: \"numeric\", weekday: \"long\", day: \"numeric\", month: \"long\"})\r\n            fecha = fecha[0].toUpperCase() + fecha.substring(1)        \r\n        /* fecha moment.js */\r\n            // let fecha = moment(cita.fecha).format(\"dddd D [de] MMMM [de] YYYY\")\r\n            // fecha = fecha[0].toUpperCase() + fecha.substring(1)\r\n\r\n        const nombreCliente = $(\"<p></p>\").html(`<span>Nombre:</span> ${nombre}`)\r\n        const fechaCita = $(\"<p></p>\").html(`<span>Fecha:</span> ${fecha}`)\r\n        const horaCita = $(\"<p></p>\").html(`<span>Hora:</span> ${hora}`)\r\n        resumen.append(nombreCliente, fechaCita, horaCita)\r\n\r\n        servicios.forEach(servicio => {\r\n            const {id, precio, nombre} = servicio\r\n            const contenedorServicio = $(\"<div></div>\").addClass(\"contenedor-servicio\")\r\n            const textoServicio = $(\"<p></p>\").text(nombre)\r\n            const precioServicio = $(\"<div></div>\").html(\"<span>Precio: </span>\"+\"$ \"+precio)\r\n            contenedorServicio.append(textoServicio, precioServicio)\r\n\r\n            resumen.append(contenedorServicio)\r\n        });\r\n\r\n        const botonReservar = $(\"<button></button>\").addClass(\"boton\").text(\"Reservar Cita\")\r\n        // botonReservar.on(\"click\", reservarCita_Fetch)\r\n        botonReservar.on(\"click\", reservarCita_jQuery)\r\n        resumen.append(botonReservar)\r\n    }\r\n}\r\nfunction seleccionarHora() {\r\n    $(\"#hora\").on(\"input\", function(e) {\r\n        const horaSeleccionada = $(this).val()\r\n        //@ts-ignore\r\n        const hora = horaSeleccionada.split(\":\")[0]\r\n        if(hora < 10 || hora > 18) {\r\n            $(this).val(\"\")\r\n            mostrarAlerta(\"Abierto de 10:00 a.m. a 6:00 p.m.\", \"error\", \"#paso-2\")\r\n            cita.hora = \"\"\r\n        } else {\r\n            cita.hora = horaSeleccionada\r\n        }\r\n    })\r\n}\r\nfunction seleccionarFecha() {\r\n    $(\"#fecha\").on(\"input\", function(e) {\r\n        const fechaSeleccionada = $(this).val()\r\n        //@ts-ignore\r\n        const dia = new Date(fechaSeleccionada).getUTCDay()\r\n        \r\n        if([0,6].includes(dia)) {\r\n            $(this).val(\"\")\r\n            mostrarAlerta(\"Fines de semana no abrimos\", \"error\", \"#paso-2\")\r\n            cita.fecha = \"\"\r\n        } else {\r\n            cita.fecha = fechaSeleccionada\r\n        }\r\n    })\r\n}\r\nfunction nombreCliente() {\r\n    cita.nombre = $(\"#nombre\").val()    \r\n}\r\nfunction idCliente() {\r\n    cita.usuarioId = $(\"#id\").val()\r\n}\r\nfunction mostrarAlerta(mensaje, tipo, elemento, desaparece = true) {\r\n    if($(\".alerta\").length) $(\".alerta\").remove()\r\n    const alerta = $(\"<div></div>\").text(mensaje).addClass(\"alerta\").addClass(tipo)\r\n    $(elemento).prepend(alerta)\r\n    if(desaparece) setTimeout(() => alerta.remove(), 4000)\r\n}\r\nfunction quitarAlertas() {\r\n    const alerta = $(\".alerta\")\r\n    if(alerta) setTimeout(() => alerta.remove(), 4000)\r\n}\r\n\r\n/* consulta API para mostrar servicios */\r\nasync function consultarAPI_Fetch() {\r\n    try {\r\n        const resultado = await fetch(\"/api/servicios\")\r\n        const servicios = await resultado.json()\r\n        mostrarServicios(servicios)        \r\n    } catch (error) {\r\n        cl(error)\r\n    }\r\n}\r\nfunction consultarAPI_jQuery() {\r\n    $.ajax({\r\n        url: \"/api/servicios\",\r\n        type: \"get\",\r\n        dataType: \"json\",\r\n        success: response => mostrarServicios(response),\r\n        error: () => cl(\"error al cargar los servicios\"),\r\n        timeout: 4000\r\n    })\r\n}\r\n/* DOM scripting */\r\nfunction mostrarServicios(servicios) {\r\n    servicios.forEach(servicio => {\r\n        const {id, nombre, precio} = servicio\r\n        \r\n        const nombreServicio = $(\"<p></p>\").addClass(\"nombre-servicio\").text(nombre)\r\n        const precioServicios = $(\"<p></p>\").addClass(\"precio-servicio\").text(\"$ \"+precio)\r\n        const servicioDiv = $(\"<div></div>\").addClass(\"servicio\").attr(\"data-id-servicio\", id)\r\n        servicioDiv.on(\"click\", function() {\r\n            seleccionarServicio(servicio)\r\n        })\r\n\r\n        servicioDiv.append(nombreServicio, precioServicios)\r\n        $(\"#servicios\").append(servicioDiv)\r\n    })\r\n}\r\nfunction seleccionarServicio(servicio) {\r\n    const {id} = servicio\r\n    const {servicios} = cita\r\n\r\n    /* comprobar si un servicio ya fue agregado o quitado */\r\n    if(servicios.some(servicio=>servicio.id === id)) {\r\n    // if(servicios.includes(servicio)) {\r\n        /* eliminarlo */\r\n        cita.servicios = servicios.filter(servicio=>servicio.id !== id)\r\n        $(`[data-id-servicio=\"${id}\"]`).removeClass(\"seleccionado\")\r\n    } else {\r\n        /* agregarlo */\r\n        cita.servicios = [...servicios, servicio]\r\n        $(`[data-id-servicio=\"${id}\"]`).addClass(\"seleccionado\")\r\n    }\r\n}\r\n\r\n/* js */\r\nfunction tabs() {\r\n    $(\".tabs button\").on(\"click\", function(e) {\r\n        paso = $(this).data(\"paso\") // parseInt(e.target.dataset.paso)\r\n\r\n        mostrarSeccion()\r\n    })\r\n}\r\n\r\nfunction mostrarSeccion() {\r\n    /* ocular la seccion que tenga la clase de mostrar */\r\n    const seccionAnterior = $(\".mostrar\")\r\n    seccionAnterior.removeClass(\"mostrar\")\r\n\r\n    /* seleccionar la seccion con el paso */\r\n    const seccion = $(`#paso-${paso}`);\r\n    seccion.addClass(\"mostrar\")\r\n\r\n    /* quita la clase de actual al tab anterior */\r\n    const tabAnterior = $(\".actual\")\r\n    tabAnterior.removeClass(\"actual\")\r\n\r\n    /* resalta el tab actual */\r\n    const tab = $(`[data-paso=\"${paso}\"]`)\r\n    tab.addClass(\"actual\")\r\n\r\n    botonesPaginador()\r\n    if(paso === 3) mostrarResumen()\r\n}\r\n\r\nfunction botonesPaginador() {\r\n    const paginaAnterior = $(\"#anterior\")\r\n    const paginaSiguiente = $(\"#siguiente\")\r\n\r\n    if(paso === 1) {\r\n        paginaAnterior.addClass(\"ocultar\")\r\n        paginaSiguiente.removeClass(\"ocultar\")\r\n    } else if(paso === 3) {\r\n        paginaSiguiente.addClass(\"ocultar\")\r\n        paginaAnterior.removeClass(\"ocultar\")\r\n    } else {\r\n        paginaSiguiente.removeClass(\"ocultar\")\r\n        paginaAnterior.removeClass(\"ocultar\")\r\n    }\r\n}\r\n\r\nfunction paginaAnterior() {\r\n    $(\"#anterior\").on(\"click\", function() { \r\n        paso-- \r\n        mostrarSeccion()\r\n    })    \r\n}\r\nfunction paginaSiguiente() {\r\n    $(\"#siguiente\").on(\"click\", function() { \r\n        paso++ \r\n        mostrarSeccion()\r\n    })    \r\n}\r\n\r\n\r\n/* otras */\r\nfunction cl(foo) {\r\n    console.log(foo)\r\n}"]}